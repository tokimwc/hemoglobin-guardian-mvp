# 引き継ぎ書

## プロジェクト概要
HemoglobinGuardianは、爪の色解析を通じて貧血リスクを推定し、栄養アドバイスを提供するアプリケーションです。

## 実装済みの機能

### 1. 画像解析機能
- Vision AIによる爪の画像解析
- HSV色空間を使用した色解析
- 画質評価（明るさ、ブレ、爪の検出）
- 信頼度スコアの計算

### 2. アドバイス生成機能
- Gemini APIを使用した栄養アドバイスの生成
- リスクレベルに応じた具体的な食事メニューの提案
- キャッシュ機能の実装

### 3. API エンドポイント
- `/analyze`: 画像解析とアドバイス生成
- `/health`: ヘルスチェック
- `/history/{user_id}`: 解析履歴の取得

## 最近の改善点

### 1. 画像解析の精度向上
- HSV色空間での色解析ロジックの改善
- リスクスコア計算の重み付け調整
- 爪の検出アルゴリズムの拡張

### 2. Gemini APIの応答改善
- プロンプトの最適化
- レスポンスパースの堅牢性向上
- エラーハンドリングの強化

### 3. 画質評価の改善
- 明るさスコアの正規化（0-1の範囲）
- ブレ検出の閾値調整
- 照明条件の判定基準の最適化

## 既知の課題

### 1. 画像解析関連
- 爪の検出精度がまだ低い
- ブレ検出が敏感すぎる可能性
- 特定の照明条件下での色解析の精度

### 2. アドバイス生成関連
- 季節性を考慮したアドバイスの生成
- リスクレベルに応じたより詳細なアドバイス
- 警告メッセージの多言語対応

## 次のステップ

### 1. 画像解析の改善
- [ ] ブレ検出の閾値をさらに調整
- [ ] 爪の検出アルゴリズムの改善
  - より多くのラベルの追加
  - 検出スコアの閾値の最適化
- [ ] 色解析の精度向上
  - 照明条件の影響を軽減
  - 色補正機能の追加

### 2. アドバイス生成の改善
- [ ] リスクレベルに応じたより具体的なアドバイス
- [ ] 季節に応じた食材の提案機能
- [ ] ユーザーの食事制限に対応したアドバイス

### 3. パフォーマンスの最適化
- [ ] 画像処理の並列化
- [ ] キャッシュ戦略の最適化
- [ ] レスポンスタイムの改善

## 技術的なメモ

### 環境設定
- Python 3.9以上が必要
- 必要なAPI：
  - Google Cloud Vision AI
  - Vertex AI (Gemini)
  - Firebase

### 重要なファイル
- `vision_service.py`: 画像解析のコア機能
- `gemini_service.py`: アドバイス生成機能
- `main.py`: FastAPIエンドポイント

### デプロイ
- Cloud Runを使用
- 環境変数の設定が必要
- CI/CDパイプラインあり

## テスト
- テストカバレッジ: 80%以上を維持
- 統合テストの実行方法:
  ```bash
  python -m pytest tests/integration/test_gemini_integration.py -v
  ```
- パフォーマンステストの実行方法:
  ```bash
  python -m pytest tests/performance/test_gemini_performance.py -v
  ``` 